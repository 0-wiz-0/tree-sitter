language: rust
rust:
  - stable

env:
  - RUST_BACKTRACE=full

script:
  # Fetch and regenerate the fixture parsers
  - script/fetch-fixtures
  - cargo build --release
  - script/regenerate-fixtures

  # Run tests
  - export TREE_SITTER_TEST=1
  - export TREE_SITTER_STATIC_ANALYSIS=1
  - cargo test

branches:
  only:
  - master

cache:
  cargo: true
  directories:
    - test/fixtures/grammars
